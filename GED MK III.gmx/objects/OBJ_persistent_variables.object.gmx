<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>SPR_counter</spriteName>
  <solid>0</solid>
  <visible>0</visible>
  <depth>10000</depth>
  <persistent>-1</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//load save data
ini_open("savedata.ini")
gold = ini_read_real("data", "gold", 0)
gold_multiplier = ini_read_real("data", "gmult", 1)
//how many stages of the current runthrough has the player completed?
stage = ini_read_real("data", "stage", 0)
//which runthrough is the player on?
run = ini_read_real("data", "run", 1)
//upgrades of non-element items
hp_lvl = ini_read_real("data", "hp", 0)
purse_lvl = ini_read_real("data", "purse", 0)
//store player upgrades
upgrade[ELEMENT_NULL] = 0
for (i = ELEMENT_FIRE; i &lt; ELEMENT_NULL; i ++) {
    upgrade[i] = ini_read_real("data", "elem" + string(i), 1)
}
hand_size = ini_read_real("data", "hand", 7)
ini_close()

save_counter = 0

ini_open("gamedata.ini")

//what element level gives what base damage?
for (i = 0; i &lt;= MAX_LEVEL; i ++) {
    damage[i] = ini_read_real("elemDmg", "dmgAtLevel" + string(i), i)
    ini_write_real("elemDmg", "dmgAtLevel" + string(i), i)
}

//the cost to purchase a given upgrade
//element levels
for (i = 0; i &lt;= MAX_LEVEL; i ++) {
    upg_cost[i] = ini_read_real("elemUpgCost", "toLevel" + string(i), 50*i)
    ini_write_real("elemUpgCost", "toLevel" + string(i), upg_cost[i])
}
upg_cost[MAX_LEVEL + 1] = ini_read_string("elemUpgCost", 
                            "toLevel" + string(MAX_LEVEL + 1), "--")
ini_write_string("elemUpgCost", "toLevel" + string(MAX_LEVEL + 1), upg_cost[MAX_LEVEL + 1])

//purse levels
purse_cost[MAX_LEVEL + 1] = ini_read_string("elemUpgCost", 
                            "toLevel" + string(MAX_LEVEL + 1), "--")
ini_write_string("elemUpgCost", "toLevel" + string(MAX_LEVEL + 1), purse_cost[MAX_LEVEL + 1])
for (i = 0; i &lt;= MAX_LEVEL; i ++) {
    purse_cost[i] = ini_read_real("purseUpgCost", "toLevel" + string(i), 50*i)
    ini_write_real("purseUpgCost", "toLevel" + string(i), purse_cost[i])
}

                            
//hp levels
hp_cost[MAX_LEVEL + 1] = ini_read_string("hpUpgCost", 
                            "toLevel" + string(MAX_LEVEL + 1), "--")
ini_write_string("hpUpgCost", "toLevel" + string(MAX_LEVEL + 1), hp_cost[MAX_LEVEL + 1])
for (i = 0; i &lt;= MAX_LEVEL; i ++) {
    hp_cost[i] = ini_read_real("hpUpgCost", "toLevel" + string(i), 50*i)
    ini_write_real("hpUpgCost", "toLevel" + string(i), hp_cost[i])
}

//amount of hp the player will have given a level
hp_amount[0] = 0
for (i = 0; i &lt;= MAX_LEVEL; i ++) {
    hp_amount[i] = ini_read_real("hpAmnt", "hpAtLevel" + string(i), 50*(i+1))
    ini_write_real("hpAmnt", "hpAtLevel" + string(i), hp_amount[i])
}

//Object string map
enemy_mapid = ds_map_create()
children_listid = get_children(OBJ_enemy_parent)
for (i = 0; i &lt; ds_list_size(children_listid); i ++) {
    enemy_id = ds_list_find_value(children_listid, i)
    enemy_string = object_get_name(enemy_id)
    ds_map_add(enemy_mapid, enemy_string, enemy_id)
}
ds_map_add(enemy_mapid, "OBJ_null", OBJ_null)
ds_list_destroy(children_listid)

//establish a list of stages and what enemies they will contain
stages[0] = 0
succession[0] = 0
for (cur_stage = 0; cur_stage &lt; STAGE_COUNT; cur_stage ++) {
    stages[cur_stage] = ds_list_create()
    succession[cur_stage] = ds_list_create()
    num_enemies = ini_read_real("stage" + string(cur_stage), "enemyCount", 2)
    ini_write_real("stage" + string(cur_stage), "enemyCount", num_enemies)
    for (cur_enemy = 0; cur_enemy &lt; num_enemies; cur_enemy ++) {
        enemy_name = ini_read_string("stage" + string(cur_stage), "enemy" + string(cur_enemy), "tiger")
        successor = ini_read_string("stage" + string(cur_stage), "successor" + string(cur_enemy), "null")
        ini_write_string("stage" + string(cur_stage), "enemy" + string(cur_enemy), enemy_name)
        enemy_name = "OBJ_" + enemy_name
        successor = "OBJ_" + successor
        ds_list_add(succession[cur_stage], ds_map_find_value(enemy_mapid, successor))
        ds_list_add(stages[cur_stage], ds_map_find_value(enemy_mapid, enemy_name))
    }
}

ini_close()

prev_val[0] = gold
prev_val[1] = gold_multiplier
prev_val[2] = stage
prev_val[3] = run
prev_val[4] = hp_lvl
prev_val[5] = purse_lvl
prev_val[6] = upgrade[ELEMENT_FIRE]
prev_val[7] = upgrade[ELEMENT_EARTH]
prev_val[8] = upgrade[ELEMENT_METAL]
prev_val[9] = upgrade[ELEMENT_WATER]
prev_val[10] = upgrade[ELEMENT_WOOD]
prev_val[11] = hand_size

element_colors[ELEMENT_NULL] = c_black
element_colors[ELEMENT_FIRE] = make_color_rgb(219, 15, 19)
element_colors[ELEMENT_EARTH] = make_color_rgb(189, 127, 28)
element_colors[ELEMENT_METAL] = make_color_rgb(175, 132, 188)
element_colors[ELEMENT_WATER] = make_color_rgb(54, 71, 204)
element_colors[ELEMENT_WOOD] = make_color_rgb(23, 126, 35)

//create map of name strings to sprite indices
sprite_mapid = ds_map_create()
children_listid = get_children(OBJ_ref_parent)
for (i = 0; i &lt; ds_list_size(children_listid); i ++) {
    obj_id = ds_list_find_value(children_listid, i)
    inst = instance_create(0, 0, obj_id)
    sprite_string = sprite_get_name(inst.sprite_index)
    ds_map_add(sprite_mapid, sprite_string, inst.sprite_index)
    with (inst) instance_destroy()
    show_debug_message("#######"+sprite_string)
}
ds_list_destroy(children_listid)
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>gold_multiplier = (purse_lvl/10) + 1

if (stage == instance_number(OBJ_stage_ind)) {
    stage = 0
    run ++
}

//save_counter = (save_counter + 1) mod 100

//find if any data has changed that needs to be updated
changes_listid = ds_list_create()
if (prev_val[0] != gold)
    ds_list_add(changes_listid, 0)
if (prev_val[1] != gold_multiplier)
    ds_list_add(changes_listid, 1)
if (prev_val[2] != stage)
    ds_list_add(changes_listid, 2)
if (prev_val[3] != run)
    ds_list_add(changes_listid, 3)
if (prev_val[4] != hp_lvl)
    ds_list_add(changes_listid, 4)
if (prev_val[5] != purse_lvl)
    ds_list_add(changes_listid, 5)
if (prev_val[6] != upgrade[ELEMENT_FIRE])
    ds_list_add(changes_listid, 6)
if (prev_val[7] != upgrade[ELEMENT_EARTH])
    ds_list_add(changes_listid, 7)
if (prev_val[8] != upgrade[ELEMENT_METAL])
    ds_list_add(changes_listid, 8)
if (prev_val[9] != upgrade[ELEMENT_WATER])
    ds_list_add(changes_listid, 9)
if (prev_val[10] != upgrade[ELEMENT_WOOD])
    ds_list_add(changes_listid, 10)
if (prev_val[11] != hand_size)
    ds_list_add(changes_listid, 11)

/*if (save_counter == 0) {
    //write save data
    ini_open("savedata.ini")
    ini_write_real("data", "gold", gold)
    ini_write_real("data", "gmult", gold_multiplier)
    //how many stages of the current runthrough has the player completed?
    ini_write_real("data", "stage", stage)
    //which runthrough is the player on?
    ini_write_real("data", "run", run)
    //upgrades of non-element items
    ini_write_real("data", "hp", hp_lvl)
    ini_write_real("data", "purse", purse_lvl)
    //store player upgrades
    for (i = ELEMENT_FIRE; i &lt; ELEMENT_NULL; i ++) {
        ini_write_real("data", "elem" + string(i), upgrade[i])
    }
    ini_write_real("data", "hand", hand_size)
    ini_close()
}*/
len = ds_list_size(changes_listid)

if (len) {
    ini_open("savedata.ini")
    for (i = 0; i &lt; len; i ++) {
        index = ds_list_find_value(changes_listid, i)
        switch (index) {
            case 0: {
                prev_val[0] = gold
                ini_write_real("data", "gold", gold)
            } break
            case 1: {
                prev_val[1] = gold
                ini_write_real("data", "gmult", gold_multiplier)
            } break
            case 2: {
                prev_val[2] = gold
                ini_write_real("data", "stage", stage)
            } break
            case 3: {
                prev_val[3] = gold
                ini_write_real("data", "run", run)
            } break
            case 4: {
                prev_val[4] = gold
                ini_write_real("data", "hp", hp_lvl)
            } break
            case 5: {
                prev_val[5] = gold
                ini_write_real("data", "purse", purse_lvl)
            } break
            case 6: {
                prev_val[6] = gold
                ini_write_real("data", "elem0", upgrade[ELEMENT_FIRE])
            } break
            case 7: {
                prev_val[7] = gold
                ini_write_real("data", "elem1", upgrade[ELEMENT_EARTH])
            } break
            case 8: {
                prev_val[8] = gold
                ini_write_real("data", "elem2", upgrade[ELEMENT_METAL])
            } break
            case 9: {
                prev_val[9] = gold
                ini_write_real("data", "elem3", upgrade[ELEMENT_WATER])
            } break
            case 10: {
                prev_val[10] = gold
                ini_write_real("data", "elem4", upgrade[ELEMENT_WOOD])
            } break
            case 11: {
                prev_val[11] = gold
                ini_write_real("data", "hand", hand_size)
            } break
        }
    }
    ini_close()
}
ds_list_destroy(changes_listid)
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>0,0</point>
    <point>16,16</point>
  </PhysicsShapePoints>
</object>
