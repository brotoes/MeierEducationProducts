<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>SPR_parent</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//stats
hp_total = 10
difficulty = 150
dmg_max = 7
dmg_min = 4

hp_current = hp_total
gold = irandom(50)

//status ailments
stun = false
poison = 0

//control variables
targetted = false
turn_priority = 0

//animation variables
animation_counter = irandom(100)
flash = 0
flash_time = 10
flash_color = c_red
flying = false
width = bbox_right - bbox_left
height = bbox_bottom - bbox_top
mouseover = false
bounce_time = 10
bounce_distance = 10
bounce_counter = 0
ail_x = 0
ail_y = 0
anim_heal = false

//this is used to determine damages
primary_element = ELEMENT_NULL

//create health bar
meter_hp = instance_create(x, y + height, OBJ_meter)
meter_hp.length = width

name = "Enemy Parent"

//this enemy will be queued upon this enemy's death
//if it is not OBJ_null
successor = OBJ_null

battle_controller = instance_find(OBJ_battle_controller, 0)
cycle = instance_find(OBJ_cycle, 0)

battle_controller.used_space += bbox_right - bbox_left

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>battle_controller.target = OBJ_null
battle_controller.gold_earned += gold
ds_list_add(battle_controller.killname_listid, name)
ds_list_add(battle_controller.killval_listid, gold)

//update the turn priorities of enemies whose turns come after
for (i = 0; i &lt; instance_number(OBJ_enemy_parent); i ++) {
    to_update = instance_find(OBJ_enemy_parent, i)
    if (to_update.turn_priority &gt; turn_priority) {
        to_update.turn_priority --
    }
}

meter_hp.fill = 0
fade_out = instance_create(x, y, OBJ_fade_out)
fade_out.target_destroy = meter_hp
fade_out.fade_time = 1
fade_out.fade_sprite = sprite_index
fade_out.successor = successor
fade_out.new_priority = turn_priority
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (poison) {
    //TODO calculate this better
    dmg = poison
    hp_current -= dmg
    indicator_offset = sprite_width/2
    indicator = instance_create(x + indicator_offset, y + 50,
                                OBJ_floating_number)
    indicator.value = dmg
    indicator.color = C_POISON
    poison --
    flash = flash_time
    flash_color = C_POISON
}
battle_controller.whose_turn = (battle_controller.whose_turn + 1)
                                mod (instance_number(OBJ_enemy_parent) + 1)
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//check for death
if (hp_current &lt;= 0) {
    instance_destroy()
}

//check if it is this instance's turn
if (battle_controller.whose_turn == turn_priority and 
    hp_current &gt; 0 and alarm[0] == -1 and battle_controller.hp_current != 0) {
    alarm[0] = 30
}

//step animation
animation_counter ++

if (flash &gt; 0) {
    flash --
}

//cap hp
if (hp_current &gt; hp_total) {
    hp_current = hp_total
}

if (anim_heal) {
    randomize()
    anim_heal = false
    //create particles
    for (i = 0; i &lt; 100; i ++) {
        instance_create(x + irandom(sprite_width), y + irandom(sprite_height), OBJ_heal_particle)
    }
    //flash self
    flash = flash_time
    flash_color = C_HEAL
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="5" enumb="32">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>hp_current = 0
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>mouseover = false
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (mouse_check_button(mb_left) and cycle.menu_open = false) {
    mouseover = true
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="7">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (battle_controller.target == id and mouseover) {
    //remove self from target variable in battle_controller
    battle_controller.target = OBJ_null
} else if (mouseover){
    battle_controller.target = id
}
mouseover = false
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="4">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>mouseover = true
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//change vertical height to match floor
floor_inst = instance_find(OBJ_floor, 0)
y = floor_inst.y - height - 30

//Change variables. This doesn't need to be in draw, but it was
//convenient to put it here, at the time.
meter_hp.x = x + (width mod sprite_get_width(SPR_meter))
meter_hp.y = height + sprite_get_height(SPR_meter) + y
//meter_hp.length = sprite_width
meter_hp.fill = hp_current / hp_total

//amount the change y value for flying enemies
adjust_y = 0
//adjust height for flying
if (flying) {
    adjust_y -= 100
    adjust_y -= sin(animation_counter/15)*20
}

//draw shadow
draw_set_alpha(0.5)

draw_ellipse(x - adjust_y/2, y + height - 40 - (width - 100)/5 - adjust_y/7,
 x + width + adjust_y/2, y + height + 10, false)
draw_set_alpha(1)
draw_set_color(c_black)

                
//apply height adjustment
y += adjust_y

draw_sprite(sprite_index, 0, x, y)
draw_sprite_ext(sprite_index, 1, x, y, 1, 1, 0, flash_color, flash/flash_time)

if (stun) {
    draw_sprite(SPR_ailstun, floor(animation_counter/10), x + ail_x, y + ail_y)
}
if (poison) {
    if (stun) {
        draw_sprite(SPR_ailpoison, floor(animation_counter/10),
            x + ail_x + sprite_get_width(SPR_ailstun), y + ail_y)
    } else {
        draw_sprite(SPR_ailpoison, floor(animation_counter/10), x + ail_x, y + ail_y)
    }
}

//draw selection indicator
bounce_counter ++
theta = bounce_counter/bounce_time
bounce_offset = max(sin(theta), sin(theta+pi))*bounce_distance
if (battle_controller.target == id) {
    draw_sprite(SPR_elem_select, primary_element,
                x + sprite_width/2 - sprite_get_width(SPR_elem_select)/2,
                max(y - sprite_get_height(SPR_elem_select)/2 - bounce_offset, 0))
}
if (mouseover) {
    draw_set_alpha(0.8)
    draw_set_blend_mode(bm_add)
    draw_sprite(SPR_elem_select, primary_element,
                x + sprite_width/2 - sprite_get_width(SPR_elem_select)/2,
                max(y - sprite_get_height(SPR_elem_select)/2 - bounce_offset, 0))
    draw_set_blend_mode(bm_normal)
    draw_set_alpha(1)
}
if (not mouseover and not battle_controller.target == id) {
    bounce_counter = 0
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>0,0</point>
    <point>16,16</point>
  </PhysicsShapePoints>
</object>
